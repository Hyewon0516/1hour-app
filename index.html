<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸</title>
    <link rel="stylesheet" href="styles.css">
    <script src="config.js"></script>
    <!-- ì¹´ì¹´ì˜¤ SDK ìµœì‹  ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸ -->
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.5/kakao.min.js" integrity="sha384-dok87au0gKqJdxs7msEdBPNnKSRT+/mhTVzq+qOhcL464zXwvcrpjeWvyj1kCdq6" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container">
        <div class="logo">ğŸ¯</div>
        <h1 class="title">ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸</h1>
        <p class="subtitle">ê°„ë‹¨í•˜ê³  ì•ˆì „í•œ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸</p>
        
        <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
        <div class="login-section" id="loginSection">
            <!-- ê³µì‹ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼ -->
            <div class="official-login-section">
                <p class="section-title">ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸</p>
                <a id="kakao-login-btn" href="javascript:loginWithKakao()">
                    <img src="https://k.kakaocdn.net/14/dn/btroDszwNrM/I6efHub1SN5KCJqLm1Ovx1/o.jpg" width="222" alt="ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼" />
                </a>
                <p id="token-result" class="token-info"></p>
                <button class="api-btn" onclick="requestUserInfo()" style="visibility:hidden">ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°</button>
            </div>
        </div>
        
        <!-- ì‚¬ìš©ì ì •ë³´ ì„¹ì…˜ -->
        <div class="user-info" id="userInfo" style="display: none;">
            <img class="user-avatar" id="userAvatar" src="" alt="í”„ë¡œí•„">
            <div class="user-name" id="userName">ì‚¬ìš©ì</div>
            <div class="user-email" id="userEmail">ì´ë©”ì¼</div>
            <button class="logout-btn" onclick="kakaoLogout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
        
        <div id="statusArea"></div>
    </div>

    <script>
        // ì¹´ì¹´ì˜¤ SDK ì´ˆê¸°í™”
        Kakao.init(CONFIG.KAKAO_JS_KEY);
        
        function loginWithKakao() {
            Kakao.Auth.authorize({
                redirectUri: getRedirectUri(),
                state: 'userme',
            });
        }

        function requestUserInfo() {
            Kakao.API.request({
                url: '/v2/user/me',
            })
                .then(function(res) {
                    console.log('ì‚¬ìš©ì ì •ë³´:', res);
                    displayUserInfo(res);
                })
                .catch(function(err) {
                    console.error('ì‚¬ìš©ì ì •ë³´ ìš”ì²­ ì‹¤íŒ¨:', err);
                    alert('failed to request user information: ' + JSON.stringify(err));
                });
        }

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        function displayUserInfo(userData) {
            const userInfo = document.getElementById('userInfo');
            const loginSection = document.getElementById('loginSection');
            
            if (userInfo) userInfo.style.display = 'block';
            if (loginSection) loginSection.style.display = 'none';
            
            const userName = document.getElementById('userName');
            const userEmail = document.getElementById('userEmail');
            const userAvatar = document.getElementById('userAvatar');
            
            if (userName) userName.textContent = userData.kakao_account?.profile?.nickname || 'ì´ë¦„ ì—†ìŒ';
            if (userEmail) userEmail.textContent = userData.kakao_account?.email || 'ì´ë©”ì¼ ì •ë³´ ì—†ìŒ';
            
            if (userAvatar) {
                if (userData.kakao_account?.profile?.profile_image_url) {
                    userAvatar.src = userData.kakao_account.profile.profile_image_url;
                } else {
                    userAvatar.src = generateDefaultAvatar(userData.kakao_account?.profile?.nickname || 'ì‚¬ìš©ì');
                }
            }
        }

        // ê¸°ë³¸ ì•„ë°”íƒ€ ìƒì„±
        function generateDefaultAvatar(name) {
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];
            const color = colors[name.length % colors.length];
            return `data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="50" fill="${color}"/><text x="50" y="60" text-anchor="middle" font-size="30" fill="white">${name.charAt(0).toUpperCase()}</text></svg>`;
        }

        // ë¡œê·¸ì•„ì›ƒ
        function kakaoLogout() {
            Kakao.Auth.logout(() => {
                console.log('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
                const userInfo = document.getElementById('userInfo');
                const loginSection = document.getElementById('loginSection');
                
                if (userInfo) userInfo.style.display = 'none';
                if (loginSection) loginSection.style.display = 'block';
                
                document.getElementById('token-result').innerText = '';
                document.querySelector('.api-btn').style.visibility = 'hidden';
            });
        }

        // ì•„ë˜ëŠ” ë°ëª¨ë¥¼ ìœ„í•œ UI ì½”ë“œì…ë‹ˆë‹¤.
        displayToken()
        function displayToken() {
            var token = getCookie('authorize-access-token');

            if(token) {
                Kakao.Auth.setAccessToken(token);
                document.querySelector('#token-result').innerText = 'login success, ready to request API';
                document.querySelector('button.api-btn').style.visibility = 'visible';
            }
        }

        function getCookie(name) {
            var parts = document.cookie.split(name + '=');
            if (parts.length === 2) { return parts[1].split(';')[0]; }
        }
    </script>
</body>
</html>